# Exploratory data analysis 

## Univariate analysis

In this first part of our EDA, we will explore each variable on its own, before looking at the relationship between different variables.

### Plots of each variable over time: 

```{r}
#Flights plot 
ts_data %>% autoplot(Flights) +
  labs(title = "Flights over time", x = "Date", y = "Number of Flights")

#Price plot
ts_data %>% autoplot(Price) +
  labs(title = "Brent Oil Prices 2019 onwards", x = "Date", y = "Price")

#temp plot
ts_data %>% autoplot(temp) +
  labs(title = "Temperature over time", x = "Date", y = "Temperature in Celsius")

#precip plot
ts_data %>% autoplot(precip) +
  labs(title = "Precipitation over time", x = "Date", y = "Precipitation")

#snow plot
ts_data %>% autoplot(snow) +
  labs(title = "Snow over time", x = "Date", y = "Snow")

#windspeed plot
ts_data %>% autoplot(windspeed) +
  labs(title = "Windspeed over time", x = "Date", y = "Windspeed")

#visibility plot
ts_data %>% autoplot(visibility) +
  labs(title = "Visibility over time", x = "Date", y = "Visibility")

#humidity plot
ts_data %>% autoplot(humidity) +
  labs(title = "Humidity over time", x = "Date", y = "Humidity")


```
Here are some observations based on the data-over-time graphs above: 

- Number of Flights: There is a clear trend, and some possible seasonality. Also, the covid flight-restriction drop is extremely clear. After that, the number of flights seems to be steadily increasing (with some cycles) towards to its pre-covid level. However, from this graph we can argue that there tend to be more flights in the summer compared to the winter. A big factor causing this is obviously school holidays in the summer.
- Brent oil price: There is a clear trend, but not an obvious seasonality in the data at first glance. Further analysis is needed to determine the specifics.
- Temperature: Extremely seasonal data, without a clear trend. Always peaking in the summer months for the highest temperatures and in the winter months for the lowest ones.
- Precipitation: Difficult to interpret at this point, but some seasonality can be seen, with less precipitation in the summer months, and more in the winter months.
- Snow: Very bizarre that there's no snow at all in 2020, and then a huge peak in 2021. I need to analyze in more depth to see what's going on, but since there are so many zeros for most of the year, I'm not sure if snow as a variable will help forecast anything. 
- Windspeed: Very clear seasonality, with perhaps a downward trend for 2022-2023. 
- Visibility: Clear seasonality with the best visibility in the summer and worst in the winter. Also, the data is looking weird after 2022...
- Humidity: Clear seasonality with more humidity in the winter compared to the summer months.

### Specific plots for interesting variables 

Exploring snow in 2021 - It looks completely unusable because there is too little data. 

```{r}
#selecting data from november 2019 until march 2022 
ts_data %>% 
  filter(Date >= as.Date("2021-11-01") & Date <= as.Date("2022-03-31")) %>% 
  autoplot(snow)
```

Now lets look at what's happening to visibility:

```{r}
#selecting data from november 2019 until march 2022 
ts_data %>% 
  filter(Date >= as.Date("2021-12-01") & Date <= as.Date("2022-10-31")) %>% 
  autoplot(visibility)
```

This makes absolutely no sense, why is visibility consistently at the same value for almost all of 2022? Did something change in the weather or is this just wrong data? Probably the data is just wrong... If we do decide to use visibility in order to forecast, we will have to stop using visibility before the point where it gets weird (January 2022)


## Bivariate analysis

In this section of our EDA, we will explore the relationships between our variables, which will help us decide which to keep for our final forecasting analysis. 

Here are the specific correlations between our variables:

```{r}
cor(ts_data[,2:9])
```

Here's a heatmap of the correlations to help visualize the relationships between the variables: 

```{r}
plot_correlation(ts_data)

corr_matrix <- cor(ts_data[,2:9])

corrplot(corr_matrix, type = "upper", order = "hclust", tl.col = "black")
```

From the correlation graph, we can say the following about the correlations between our variables:

- Flights: The number of flights seems to be strongly correlated with the oil price, slightly correlated with temperature, visibility and snow. It's surprising to see that snow shows even a small correlation, given how little data we have on it. 

- Humidity: Humidity seems to be strongly inversely correlated with the temperature, the visibility, and the windspeed. 
- Price: The oil price seems to be correlated with visibility, but this is most likely a coincidence. 

```{r}
# Remove Date column
data_no_date <- data[, -1]

# Plot correlations
ggpairs(data_no_date)

```


## Conclusions from EDA

Based on our EDA, we have come to the following conclusions, regarding our analysis: 

- We will not use Snow and Visibility: snow just doesn't have enough data and is therefore very hard to forecast, and visibility looks like something changed in the way it was measure in 2022 and the data is just unusable. We will only continue our analysis using oil, temp, precip, windspeed and humidity.  

- We will split our modeling analysis into two parts: one will only work with weather data, and the other with oil price data. More details about this in the following section.

- For the weather analysis, we will split our training data from the earliest data we have up until 2 weeks before the end, and we will use the last two weeks of our data as a test set to compare our predictions with the actual observed weather data. 

- For the oil price analysis, we will split our training data from the earliest data we have up until June 2022. This is to capture the increase in the oil prices after the war in Ukraine. Then, we will use data from June 2022 until November 2022 (which is the latest data we have) to compare our models' performances with reality. 

## Final Dataset + Split train/test 

```{r}
#here's the final dataset (excluding visibility and snow)
ts_data <- ts_data[, !(names(ts_data) %in% c("snow", "visibility"))]


#Oil training and test
ts_data_oil <- ts_data %>% select(Date,Flights,Price)
#selecting everything until 1st jan 2022
ts_data_oil_tr <-  ts_data_oil %>% filter(Date < as.Date("2022-01-01"))
#selecting everything from 1st jan 2022 onwards
ts_data_oil_te <- ts_data_oil %>% filter(Date >= as.Date("2022-01-01"))



#Weather training and test
ts_data_weather <- ts_data %>% select(Date,Flights,temp,precip,windspeed,humidity)
#selecting everything until the last two weeks of data
ts_data_weather_tr <- ts_data_weather %>% filter(Date < as.Date("2022-10-31"))
#selecting everything in the last two weeks of data
ts_data_weather_te <- ts_data_weather %>% filter(Date >= as.Date("2022-10-31"))

```




