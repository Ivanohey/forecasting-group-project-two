# Data cleaning
```{r data_import, include=FALSE}
data_2020 <- read.csv("data/2020-States.csv")
data_2021 <- read.csv("data/2021-States.csv")
data_2022 <- read.csv("data/2022-States.csv")
data_2023 <- read.csv("data/2023-States.csv")

```

```{r data_merge}
#Flights data


#Merge all flights datasets together
data_2019 <- select(data_2020, Entity, Day.2019, Flights.2019..Reference.) %>% rename(Day = Day.2019, Flights = Flights.2019..Reference.)
data_2020 <- select(data_2020, Entity, Day, Flights)
data_2021 <- select(data_2021, Entity, Day, Flights)
data_2022 <- select(data_2022, Entity, Day, Flights)
data_2023 <- select(data_2023, Entity, Day, Flights)
data_all_years <- rbind(data_2019, data_2020, data_2021, data_2022, data_2023)

#Select only data where country == switzerland
flights <- data_all_years[data_all_years$Entity == 'Switzerland',]
flights$year_month = format(as.Date(flights$Day), "%Y-%m")

flights <- flights %>% select(Day,Flights) %>% set_names(c("Date", "Flights"))

```

```{r}
#Weather data
weather <- read_excel("data/switzerland weather.xlsx")

#Select appropriate columns (which covariates we will use)

weather <- weather %>% select(datetime,temp, precip, snow, windspeed, visibility, humidity)

#Some summary statistics for all columns
weather %>% dfSummary(style = "grid")

```

```{r}
#Oil data 

oil <- read.csv("data/BrentOilPrices.csv")

#Check for NA's, there's none
#sum(is.na(oil))

#Convert the "Date" column to a date format:
oil$Date <- parse_date_time(oil$Date, orders = c("%d-%b-%y", "%b %d, %Y"))

#Summary statistics 
oil %>% dfSummary(style = "grid")


#Plot the time series 
ggplot(oil, aes(x = Date, y = Price)) +
  geom_line() +
  labs(title = "Brent Oil Prices (all data)", x = "Date", y = "Price")

#convert to tsibble object 
#oil <- oil %>%
  #mutate(Date = yearmonth(Date)) %>% #need to do this before converting to get proper format
  #as_tsibble(index = Date)


#Select appropriate dates
oil <- oil %>%
  mutate(Date = as.Date(Date)) %>%
  filter(Date > as.Date("2019-01-01"))

#remember you HAVE to assign to a new variable if you are changing to a tsibble... You can't just have oil <- oil %>% ... 
oil_ts <- tsibble(Date = as.Date(oil$Date), Price = oil$Price) 

#Plot the time series 
oil_ts %>% autoplot() +
  labs(title = "Brent Oil Prices 2019 onwards", x = "Date", y = "Price")
```

