
# Forecasting Flights

After having forecasted and selected our covariates, it's time to forecast the number of flights. 

First, let's create a table that contains all the forecasts from our covariates: 

```{r}
Full_Data = left_join(weather, Flights_Holidays, by="date")

#Join all covariate forecast tables together
cov_fc <- left_join(forecast_table_tslm_temp, forecast_table_tslm_precip, by = "Date")
cov_fc <- left_join(cov_fc, forecast_table_tslm_windspeed, by = "Date")
cov_fc <- left_join(cov_fc, forecast_table_tslm_humidity, by = "Date")

# round columns 2 to 5 to 2 decimals
cov_fc <- cov_fc %>%
  mutate_at(vars(2:5), ~ round(., 2))

```

```{r flights_holiday_weather}




```





```{r arima_model_with_covid }
#With covid
holidays_total = Flights_Holidays %>% mutate(is_holiday = as.factor(is_holiday)) %>% as_tsibble()
holidays_train_set = holidays_total %>% filter(date < as.Date("2023-02-28"))
holidays_test_set = holidays_total %>% filter(date >= as.Date("2023-02-28"))


#Without holidays
arima_flights = holidays_train_set %>% 
  model(ARIMA(departures, stepwise= FALSE, approximation = FALSE)) %>% 
  forecast(h = nrow(holidays_test_set))

#With holidays
sarimax_flights = holidays_train_set %>% 
  model(ARIMA(departures ~ is_holiday, stepwise= FALSE)) %>% 
  forecast(new_data = as_tsibble(holidays_test_set))

autoplot(arima_flights) +
  geom_line(aes(x=holidays_test_set$date, y=holidays_test_set$departures)) +
  ggtitle("ARIMA model for whole time frame")

autoplot(sarimax_flights) +
  geom_line(aes(x=holidays_test_set$date, y=holidays_test_set$departures)) +
  ggtitle("SARIMAX model with for holiday regressor")

```



```{r arima_model_before_covid}
#Before covid
str(Flights_Holidays_Covid)

#Creating train and test sets
holidays_total_covid = Flights_Holidays_Covid %>% mutate(is_holiday = as.factor(is_holiday)) %>% as_tsibble()
holidays_train_covid = holidays_total_covid %>% filter( date < as.Date("2019-08-01"))
holidays_test_covid = holidays_total_covid %>% filter(date >= as.Date("2019-08-01"))


#Without holidays
arima_flights_holidays = holidays_train_covid %>% 
  model(ARIMA(departures, stepwise= FALSE)) %>% 
  forecast(h = nrow(holidays_test_covid))

#With holidays
sarimax_flights_holidays = holidays_train_covid %>% 
  model(ARIMA(departures ~ is_holiday, stepwise= FALSE)) %>% 
  forecast(new_data = as_tsibble(holidays_test_covid))


#Plotting

#Without regressors
autoplot(arima_flights_holidays) #+
  # geom_line(aes(x=holidays_test_covid$date, y=holidays_test_covid$departures)) + 
  # geom_line(aes(x=holidays_train_covid$date, y=holidays_train_covid$departures))+
  # ggtitle("ARIMA forecast")

#With regressors
autoplot(sarimax_flights_holidays) + 
  geom_line(aes(x = holidays_test_covid$date, y = holidays_test_covid$departures)) +
  ggtitle("SARIMAX forecast with is_holiday regressor") 


```
